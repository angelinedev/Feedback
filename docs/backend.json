{
  "entities": {
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the student entity."
        },
        "registerNumber": {
          "type": "string",
          "description": "The student's 16-digit registration number.",
          "format": "string"
        },
        "password": {
          "type": "string",
          "description": "The student's password. This is only for demonstration. Follow secure password practices and hashing."
        },
        "className": {
          "type": "string",
          "description": "The class name the student belongs to."
        },
        "name": {
          "type": "string",
          "description": "The name of the student."
        }
      },
      "required": [
        "id",
        "registerNumber",
        "password",
        "className",
        "name"
      ]
    },
    "Faculty": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Faculty",
      "type": "object",
      "description": "Represents a faculty member record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the faculty entity."
        },
        "facultyId": {
          "type": "string",
          "description": "The faculty's 3-4 digit ID number."
        },
        "password": {
          "type": "string",
          "description": "The faculty's password. This is only for demonstration. Follow secure password practices and hashing."
        },
        "name": {
          "type": "string",
          "description": "The name of the faculty member."
        },
        "department": {
          "type": "string",
          "description": "The department to which the faculty belongs."
        }
      },
      "required": [
        "id",
        "facultyId",
        "password",
        "name",
        "department"
      ]
    },
    "ClassFacultyMapping": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClassFacultyMapping",
      "type": "object",
      "description": "Represents the mapping between classes, faculty, and subjects.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the class faculty mapping entity."
        },
        "className": {
          "type": "string",
          "description": "The name of the class."
        },
        "facultyId": {
          "type": "string",
          "description": "Reference to Faculty. (Relationship: Faculty 1:N ClassFacultyMapping)"
        },
        "subject": {
          "type": "string",
          "description": "The subject being taught."
        }
      },
      "required": [
        "id",
        "className",
        "facultyId",
        "subject"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a feedback question.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the question entity."
        },
        "text": {
          "type": "string",
          "description": "The text of the feedback question."
        }
      },
      "required": [
        "id",
        "text"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents a student's feedback submission.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Feedback)"
        },
        "classFacultyMappingId": {
          "type": "string",
          "description": "Reference to ClassFacultyMapping. (Relationship: ClassFacultyMapping 1:N Feedback)"
        },
        "questionId": {
          "type": "string",
          "description": "Reference to Question. (Relationship: Question 1:N Feedback)"
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the student (1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Optional anonymous comment from the student."
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time of feedback submission.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "studentId",
        "classFacultyMappingId",
        "questionId",
        "rating",
        "submissionDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student profiles. 'studentId' corresponds to 'auth.uid'.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student (matches auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/faculty/{facultyId}",
        "definition": {
          "entityName": "Faculty",
          "schema": {
            "$ref": "#/backend/entities/Faculty"
          },
          "description": "Stores faculty profiles. 'facultyId' corresponds to 'auth.uid'.",
          "params": [
            {
              "name": "facultyId",
              "description": "The unique identifier of the faculty member (matches auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/classFacultyMapping/{classFacultyMappingId}",
        "definition": {
          "entityName": "ClassFacultyMapping",
          "schema": {
            "$ref": "#/backend/entities/ClassFacultyMapping"
          },
          "description": "Maps classes to faculty and subjects. Central timetable.",
          "params": [
            {
              "name": "classFacultyMappingId",
              "description": "The unique identifier of the class-faculty mapping."
            }
          ]
        }
      },
      {
        "path": "/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores the feedback questions.",
          "params": [
            {
              "name": "questionId",
              "description": "The unique identifier of the feedback question."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}/feedback/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores student feedback submissions. Includes denormalized 'studentId' and 'classFacultyMappingId' for authorization independence.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student providing the feedback."
            },
            {
              "name": "feedbackId",
              "description": "The unique identifier of the feedback submission."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Indicates admin roles. Existence of a document grants admin privileges. The content of the document is not important.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the admin user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support FeedLoop v2's requirements for student feedback, faculty reporting, and admin analytics, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. The structure leverages path-based ownership for user data (students, faculty), and a membership map approach for collaborative data. Segregation of concerns is achieved by separating user roles (admin) into dedicated collections.\n\n**Authorization Independence:**\n*   `Feedback` documents include denormalized `studentId`, `classFacultyMappingId`, and implicitly the `className` from `classFacultyMappingId`. This ensures that authorization rules for accessing feedback do not require `get()` calls to parent documents (Student or ClassFacultyMapping), maintaining atomic operations and simplifying rules.\n\n**QAPs (Rules are not Filters):**\n*   The structure enables secure list operations (QAPs) via structural segregation and the use of path-based ownership where applicable. For instance, listing feedback entries will be secured at the collection group level (if required) using the denormalized `className` for filtering.\n*   Admin roles are checked via the `/roles_admin/{uid}` collection, allowing secure listing of admin-related data.\n\n**Structure Overview:**\n*   `/students/{studentId}`: Stores student profiles (registerNumber, className, etc.). The `studentId` is the document ID and corresponds to `auth.uid` for path-based access.\n*   `/faculty/{facultyId}`: Stores faculty profiles (facultyId, department, etc.). The `facultyId` is the document ID and corresponds to `auth.uid` for path-based access.\n*   `/classFacultyMapping/{classFacultyMappingId}`: Maps classes to faculty and subjects. This is the central timetable.\n*   `/questions/{questionId}`: Stores the feedback questions.\n*   `/students/{studentId}/feedback/{feedbackId}`: Stores student feedback submissions. Denormalized `classFacultyMappingId` for authorization independence.\n*   `/roles_admin/{uid}`: Indicates admin roles. Existence of a document grants admin privileges.\n\nThis structure facilitates straightforward security rules because of its emphasis on authorization independence and structural segregation. Specifically, rules will focus on verifying the existence of documents in `/roles_admin/{uid}` for admin access, enforcing path-based ownership in `/students/{studentId}` and `/faculty/{facultyId}`, and using denormalized data in `/students/{studentId}/feedback/{feedbackId}` to control access based on class and faculty mappings."
  }
}